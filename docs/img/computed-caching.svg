<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 380" width="100%" height="100%">
  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#f4f8fd"/>
      <stop offset="50%" stop-color="#eaf1fb"/>
      <stop offset="100%" stop-color="#e2ebf7"/>
    </linearGradient>
    <clipPath id="clip1"><rect x="462" y="44" width="420" height="124" rx="8"/></clipPath>
    <clipPath id="clip2"><rect x="462" y="180" width="420" height="100" rx="8"/></clipPath>
    <style>
      .code { font-family: "SF Mono","Fira Code","Cascadia Code",Consolas,Menlo,Monaco,monospace; font-size: 12px; fill: #1a1a2e }
      .result { font-family: "SF Mono","Fira Code","Cascadia Code",Consolas,Menlo,Monaco,monospace; font-size: 12px; fill: #4a8c66 }
      .card-title { font-family: "SF Mono","Fira Code","Cascadia Code",Consolas,Menlo,Monaco,monospace; font-size: 11px; fill: #ffffff }
      .card-type { font-family: Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif; font-size: 10px; fill: #6b7084; font-style: italic }
      .card-val { font-family: "SF Mono","Fira Code","Cascadia Code",Consolas,Menlo,Monaco,monospace; font-size: 12px; fill: #1a1a2e }
      .card-val-old { font-family: "SF Mono","Fira Code","Cascadia Code",Consolas,Menlo,Monaco,monospace; font-size: 11px; fill: #9a9a9a }
      .tag-con { font-family: Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif; font-size: 10px; fill: #4a8c66; font-weight: 500 }
      .tag-inc { font-family: Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif; font-size: 10px; fill: #a07858; font-weight: 500 }
      .tag-old { font-family: Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif; font-size: 9px; fill: #aaa; font-style: italic }
      .computing { font-family: Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif; font-size: 11px; fill: #5a88c0; font-style: italic }
      .panel-label { font-family: Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif; font-size: 11px; fill: #8b90a8; font-weight: 600; letter-spacing: 0.5px; text-transform: uppercase }
      .cached-tag { font-family: Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif; font-size: 10px; fill: #5a88c0; font-weight: 500 }
      .legend { font-family: Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif; font-size: 10px; fill: #8b90a8 }

      /*
       * Timeline (14s = 100%):
       *
       *  0-3%   (0-0.5s)   All visible, dim. Cards empty.
       *  7%     (1s)        Line 1 highlights
       * 10%     (1.4s)      Card1 → computing
       * 14%     (2s)        Line 1 result appears; Card1 → v1:"Dani" consistent
       * 21%     (3s)        Line 2 highlights
       * 24%     (3.4s)      Card2 → computing
       * 28%     (4s)        Line 2 result appears; Card2 → v1:"Bob" consistent
       * 36%     (5s)        Brief hold
       * 39%     (5.5s)      Line 3 highlights; Card1 v1 → inconsistent
       * 50%     (7s)        Line 4 highlights
       * 53%     (7.4s)      Card1 → recomputing
       * 60%     (8.5s)      Line 4 result; Card1 v2:"Daniella" consistent; v1 stays grayed
       * 71%     (10s)       Line 5 highlights; Card2 cache hit flash
       * 75%     (10.5s)     Line 5 "(cached)" appears
       * 100%    (14s)       Hold
       */

      /* === LEFT PANEL: Code line highlighting === */
      @keyframes acc1 { 0%,5%{opacity:0} 7%,13%{opacity:1} 15%,100%{opacity:0} }
      @keyframes acc2 { 0%,19%{opacity:0} 21%,27%{opacity:1} 29%,100%{opacity:0} }
      @keyframes acc3 { 0%,37%{opacity:0} 39%,48%{opacity:1} 50%,100%{opacity:0} }
      @keyframes acc4 { 0%,48%{opacity:0} 50%,59%{opacity:1} 61%,100%{opacity:0} }
      @keyframes acc5 { 0%,69%{opacity:0} 71%,100%{opacity:1} }

      @keyframes ln1 { 0%,5%{opacity:0.35} 7%,13%{opacity:1} 15%,100%{opacity:0.35} }
      @keyframes ln2 { 0%,19%{opacity:0.35} 21%,27%{opacity:1} 29%,100%{opacity:0.35} }
      @keyframes ln3 { 0%,37%{opacity:0.35} 39%,48%{opacity:1} 50%,100%{opacity:0.35} }
      @keyframes ln4 { 0%,48%{opacity:0.35} 50%,59%{opacity:1} 61%,100%{opacity:0.35} }
      @keyframes ln5 { 0%,69%{opacity:0.35} 71%,100%{opacity:1} }

      @keyframes res1 { 0%,12%{opacity:0} 16%,100%{opacity:1} }
      @keyframes res2 { 0%,26%{opacity:0} 30%,100%{opacity:1} }
      @keyframes res4 { 0%,58%{opacity:0} 62%,100%{opacity:1} }
      @keyframes res5 { 0%,73%{opacity:0} 77%,100%{opacity:1} }

      /* === RIGHT PANEL: Card 1 (session1) === */
      /* Body: empty → computing → green → bleached → computing → green */
      @keyframes c1body {
        0%,8%  {fill:#f0f4fa;stroke:#d8dce6;stroke-width:1}
        10%,13%{fill:#dae8fb;stroke:#6b9ad4;stroke-width:1.5}
        15%,37%{fill:#c8e8d0;stroke:#78b490;stroke-width:1.5}
        40%,51%{fill:#ede8e3;stroke:#c4bab2;stroke-width:1.5}
        53%,58%{fill:#dae8fb;stroke:#6b9ad4;stroke-width:1.5}
        62%,100%{fill:#c8e8d0;stroke:#78b490;stroke-width:1.5}
      }
      /* computing / recomputing labels */
      @keyframes c1comp1 { 0%,8%{opacity:0} 10%,13%{opacity:1} 15%,100%{opacity:0} }
      @keyframes c1comp2 { 0%,51%{opacity:0} 53%,58%{opacity:1} 60%,100%{opacity:0} }

      /* v1 on main line: appears → stays at full → dims to gray when v2 arrives */
      @keyframes c1v1 { 0%,13%{opacity:0} 15%,58%{opacity:1} 62%,100%{opacity:0} }
      /* v1 shifted to secondary line (grayed) — appears when v2 takes the main line */
      @keyframes c1v1old { 0%,58%{opacity:0} 62%,100%{opacity:0.7} }

      /* v1 tags */
      @keyframes c1tag1c { 0%,13%{opacity:0} 15%,37%{opacity:1} 40%,100%{opacity:0} }
      @keyframes c1tag1i { 0%,38%{opacity:0} 41%,51%{opacity:1} 53%,100%{opacity:0} }

      /* v2 on main line + its tag */
      @keyframes c1v2 { 0%,58%{opacity:0} 62%,100%{opacity:1} }
      @keyframes c1tag2c { 0%,58%{opacity:0} 62%,100%{opacity:1} }
      /* "still in memory" label for old v1 */
      @keyframes c1mem { 0%,60%{opacity:0} 64%,100%{opacity:1} }

      /* === RIGHT PANEL: Card 2 (session2) === */
      @keyframes c2body {
        0%,22%  {fill:#f0f4fa;stroke:#d8dce6;stroke-width:1}
        24%,27% {fill:#dae8fb;stroke:#6b9ad4;stroke-width:1.5}
        30%,69% {fill:#c8e8d0;stroke:#78b490;stroke-width:1.5}
        71%,73% {fill:#b8e0c0;stroke:#5aa87a;stroke-width:2}
        76%,100%{fill:#c8e8d0;stroke:#78b490;stroke-width:1.5}
      }
      @keyframes c2comp { 0%,22%{opacity:0} 24%,27%{opacity:1} 30%,100%{opacity:0} }
      @keyframes c2v1 { 0%,27%{opacity:0} 30%,100%{opacity:1} }
      @keyframes c2tag1c { 0%,27%{opacity:0} 30%,100%{opacity:1} }
      @keyframes c2hit { 0%,69%{opacity:0} 71%,76%{opacity:1} 79%,100%{opacity:0} }

      /* === Computed instance boxes === */
      /* Card1 v1 box: green → bleached → hidden */
      @keyframes c1v1bx {
        0%,13%{opacity:0}
        15%,37%{opacity:1;fill:#e8f5ec;stroke:#88c4a0}
        40%,58%{opacity:1;fill:#f5f0eb;stroke:#c4bab2}
        62%,100%{opacity:0}
      }
      /* Card1 v2 box: appears green */
      @keyframes c1v2bx { 0%,58%{opacity:0} 62%,100%{opacity:1} }
      /* Card1 v1-old box: appears grayed */
      @keyframes c1v1oldbx { 0%,58%{opacity:0} 62%,100%{opacity:0.7} }
      /* Card2 v1 box: green, pulse on cache hit */
      @keyframes c2v1bx {
        0%,27%{opacity:0}
        30%,69%{opacity:1;fill:#e8f5ec;stroke:#88c4a0}
        71%,73%{opacity:1;fill:#d8f0e0;stroke:#5aa87a}
        76%,100%{opacity:1;fill:#e8f5ec;stroke:#88c4a0}
      }

      /* Apply animations */
      #acc1{animation:acc1 14s ease forwards} #acc2{animation:acc2 14s ease forwards}
      #acc3{animation:acc3 14s ease forwards} #acc4{animation:acc4 14s ease forwards}
      #acc5{animation:acc5 14s ease forwards}
      #ln1{animation:ln1 14s ease forwards} #ln2{animation:ln2 14s ease forwards}
      #ln3{animation:ln3 14s ease forwards} #ln4{animation:ln4 14s ease forwards}
      #ln5{animation:ln5 14s ease forwards}
      #res1{animation:res1 14s ease forwards} #res2{animation:res2 14s ease forwards}
      #res4{animation:res4 14s ease forwards} #res5{animation:res5 14s ease forwards}
      #c1body{animation:c1body 14s ease forwards}
      #c1comp1{animation:c1comp1 14s ease forwards} #c1comp2{animation:c1comp2 14s ease forwards}
      #c1v1{animation:c1v1 14s ease forwards} #c1v1old{animation:c1v1old 14s ease forwards}
      #c1tag1c{animation:c1tag1c 14s ease forwards} #c1tag1i{animation:c1tag1i 14s ease forwards}
      #c1v2{animation:c1v2 14s ease forwards} #c1tag2c{animation:c1tag2c 14s ease forwards}
      #c1mem{animation:c1mem 14s ease forwards}
      #c2body{animation:c2body 14s ease forwards}
      #c2comp{animation:c2comp 14s ease forwards}
      #c2v1{animation:c2v1 14s ease forwards} #c2tag1c{animation:c2tag1c 14s ease forwards}
      #c2hit{animation:c2hit 14s ease forwards}
      #c1v1bx{animation:c1v1bx 14s ease forwards} #c1v2bx{animation:c1v2bx 14s ease forwards}
      #c1v1oldbx{animation:c1v1oldbx 14s ease forwards} #c2v1bx{animation:c2v1bx 14s ease forwards}
    </style>
  </defs>

  <!-- Background -->
  <rect width="900" height="380" rx="10" fill="url(#bg)"/>

  <!-- Divider line -->
  <line x1="440" y1="30" x2="440" y2="350" stroke="#c8d0dc" stroke-width="1" stroke-dasharray="4,3" opacity="0.6"/>

  <!-- Panel labels -->
  <text x="228" y="26" class="panel-label" text-anchor="middle">Code</text>
  <text x="670" y="26" class="panel-label" text-anchor="middle">Cached Computed Values</text>

  <!-- ==================== LEFT PANEL: Code ==================== -->

  <!-- Line 1: GetUserName("session1") -->
  <rect id="acc1" x="24" y="44" width="3" height="18" rx="1.5" fill="#5a88c0" opacity="0"/>
  <g id="ln1" opacity="0.35">
    <text x="34" y="58" class="code">GetUserName(<tspan fill="#a05020">"session1"</tspan>);</text>
  </g>
  <text id="res1" x="290" y="58" class="result" opacity="0">// &#x2192; "Dani"</text>

  <!-- Line 2: GetUserName("session2") -->
  <rect id="acc2" x="24" y="78" width="3" height="18" rx="1.5" fill="#5a88c0" opacity="0"/>
  <g id="ln2" opacity="0.35">
    <text x="34" y="92" class="code">GetUserName(<tspan fill="#a05020">"session2"</tspan>);</text>
  </g>
  <text id="res2" x="290" y="92" class="result" opacity="0">// &#x2192; "Bob"</text>

  <!-- Line 3: Invalidate -->
  <rect id="acc3" x="24" y="126" width="3" height="36" rx="1.5" fill="#b87830" opacity="0"/>
  <g id="ln3" opacity="0.35">
    <text x="34" y="140" class="code">Invalidate(() =&gt;</text>
    <text x="34" y="156" class="code">    GetUserName(<tspan fill="#a05020">"session1"</tspan>));</text>
  </g>

  <!-- Line 4: GetUserName("session1") again -->
  <rect id="acc4" x="24" y="182" width="3" height="18" rx="1.5" fill="#5a88c0" opacity="0"/>
  <g id="ln4" opacity="0.35">
    <text x="34" y="196" class="code">GetUserName(<tspan fill="#a05020">"session1"</tspan>);</text>
  </g>
  <text id="res4" x="290" y="196" class="result" opacity="0">// &#x2192; "Daniella"</text>

  <!-- Line 5: GetUserName("session2") again -->
  <rect id="acc5" x="24" y="216" width="3" height="18" rx="1.5" fill="#5a88c0" opacity="0"/>
  <g id="ln5" opacity="0.35">
    <text x="34" y="230" class="code">GetUserName(<tspan fill="#a05020">"session2"</tspan>);</text>
  </g>
  <text id="res5" x="290" y="230" class="result" opacity="0">// &#x2192; "Bob" <tspan class="cached-tag">(cached)</tspan></text>


  <!-- ==================== RIGHT PANEL: Cards ==================== -->

  <!-- ===== Card 1: GetUserName, "session1" ===== -->
  <g clip-path="url(#clip1)">
    <rect id="c1body" x="462" y="44" width="420" height="124" rx="8" fill="#f0f4fa" stroke="#d8dce6" stroke-width="1"/>
    <rect x="462" y="44" width="420" height="28" fill="#5c6b82"/>
  </g>
  <rect x="462" y="44" width="420" height="124" rx="8" fill="none" stroke="#d8dce6" stroke-width="0.5" opacity="0.3"/>

  <text x="476" y="63" class="card-title">GetUserName, "session1"</text>

  <!-- Card1 type label -->
  <text x="476" y="90" class="card-type">Computed&lt;string&gt;</text>

  <!-- Card1 "computing..." / "recomputing..." labels -->
  <text id="c1comp1" x="476" y="112" class="computing" opacity="0">computing...</text>
  <text id="c1comp2" x="476" y="134" class="computing" opacity="0">recomputing...</text>

  <!-- Card1 v1 instance box + text (main line) -->
  <rect id="c1v1bx" x="470" y="99" width="404" height="20" rx="5" fill="#e8f5ec" stroke="#88c4a0" stroke-width="1" opacity="0"/>
  <g id="c1v1" opacity="0">
    <text x="476" y="112" class="card-val">v1: <tspan fill="#2d6a4f">"Dani"</tspan></text>
  </g>
  <text id="c1tag1c" x="868" y="112" class="tag-con" text-anchor="end" opacity="0">&#x2713; consistent</text>
  <text id="c1tag1i" x="868" y="112" class="tag-inc" text-anchor="end" opacity="0">&#x2717; inconsistent</text>

  <!-- Card1 v2 instance box + text (main line) -->
  <rect id="c1v2bx" x="470" y="99" width="404" height="20" rx="5" fill="#e8f5ec" stroke="#88c4a0" stroke-width="1" opacity="0"/>
  <g id="c1v2" opacity="0">
    <text x="476" y="112" class="card-val">v2: <tspan fill="#2d6a4f">"Daniella"</tspan></text>
  </g>
  <text id="c1tag2c" x="868" y="112" class="tag-con" text-anchor="end" opacity="0">&#x2713; consistent</text>

  <!-- Card1 v1 grayed instance box + text (secondary line, persists in memory) -->
  <rect id="c1v1oldbx" x="470" y="122" width="404" height="18" rx="5" fill="#f2f2f2" stroke="#ccc" stroke-width="0.75" opacity="0"/>
  <g id="c1v1old" opacity="0">
    <text x="476" y="134" class="card-val-old">v1: "Dani"</text>
    <text x="564" y="134" class="tag-old">stays in RAM until unreferenced (can be used in States, etc.)</text>
  </g>

  <!-- ===== Card 2: GetUserName, "session2" ===== -->
  <g clip-path="url(#clip2)">
    <rect id="c2body" x="462" y="180" width="420" height="100" rx="8" fill="#f0f4fa" stroke="#d8dce6" stroke-width="1"/>
    <rect x="462" y="180" width="420" height="28" fill="#5c6b82"/>
  </g>
  <rect x="462" y="180" width="420" height="100" rx="8" fill="none" stroke="#d8dce6" stroke-width="0.5" opacity="0.3"/>

  <text x="476" y="199" class="card-title">GetUserName, "session2"</text>

  <!-- Card2 type label -->
  <text x="476" y="228" class="card-type">Computed&lt;string&gt;</text>

  <!-- Card2 "computing..." state -->
  <text id="c2comp" x="476" y="254" class="computing" opacity="0">computing...</text>

  <!-- Card2 v1 instance box + text -->
  <rect id="c2v1bx" x="470" y="241" width="404" height="20" rx="5" fill="#e8f5ec" stroke="#88c4a0" stroke-width="1" opacity="0"/>
  <g id="c2v1" opacity="0">
    <text x="476" y="254" class="card-val">v1: <tspan fill="#2d6a4f">"Bob"</tspan></text>
  </g>
  <text id="c2tag1c" x="868" y="254" class="tag-con" text-anchor="end" opacity="0">&#x2713; consistent</text>

  <!-- Card2 cache-hit flash label -->
  <text id="c2hit" x="672" y="270" class="cached-tag" text-anchor="middle" opacity="0">&#x21E0; cache hit</text>

  <!-- Legend -->
  <text x="476" y="318" class="legend">ComputedRegistry: one Computed&lt;T&gt; per ComputedInput = (service, method, args).</text>
  <text x="476" y="334" class="legend">Invalidation evicts the entry; old instances stay in RAM until GC'd.</text>
</svg>
